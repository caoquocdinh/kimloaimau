<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kim loại màu và Hợp kim màu</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding-bottom: 30px;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: linear-gradient(to right, #2c3e50, #4a6491);
            color: white;
            padding: 25px 0;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1611095772763-5b0d0b7b0b1b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1920&q=80') center/cover;
            opacity: 0.1;
        }
        
        .header h1 {
            font-weight: 700;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            margin-bottom: 0;
            position: relative;
        }
        
        .header i {
            margin-right: 15px;
            color: #3498db;
        }
        
        #tree-container {
            width: 100%;
            height: 750px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            position: relative;
            overflow: hidden;
        }
        
        #info-panel {
            border: 1px solid #dee2e6;
            padding: 25px;
            background-color: white;
            border-radius: 12px;
            min-height: 400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
        }
        
        #info-panel:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-5px);
        }
        
        .info-title {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
        }
        
        .info-title i {
            margin-right: 10px;
            color: #3498db;
        }
        
        .node circle {
            stroke-width: 3px;
            stroke-opacity: 0.8;
            transition: all 0.2s ease;
            cursor: pointer;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }
        
        .node circle:hover {
            stroke-width: 4px;
            r: 16px;
        }
        
        .node text {
            font: 14px 'Segoe UI', sans-serif;
            font-weight: 600;
            fill: #333;
            text-shadow: 0 1px 2px rgba(255,255,255,0.8);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .node text:hover {
            font-weight: 700;
            fill: #2c3e50;
        }
        
        .link {
            fill: none;
            stroke: #95a5a6;
            stroke-width: 2px;
            stroke-opacity: 0.6;
        }
        
        .copper { fill: #e74c3c; stroke: #c0392b; }
        .copper-alloy { fill: #e67e22; stroke: #d35400; }
        .aluminum { fill: #7f8c8d; stroke: #34495e; }
        .aluminum-alloy { fill: #3498db; stroke: #2980b9; }
        .properties { fill: #9b59b6; stroke: #8e44ad; }
        .application { fill: #2ecc71; stroke: #27ae60; }
        .symbol { fill: #f1c40f; stroke: #f39c12; }
        .root-node { fill: #2c3e50; stroke: #1a2530; }
        
        .info-content {
            line-height: 1.7;
            font-size: 16px;
        }
        
        .info-content ul {
            padding-left: 25px;
            margin: 15px 0;
        }
        
        .info-content li {
            margin-bottom: 8px;
        }
        
        /* Cải tiến hiển thị hình ảnh */
        .image-container {
            position: relative;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
            background: #f5f5f5;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #eee;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .info-image {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
            display: block;
            border-radius: 8px;
            transition: all 0.3s ease;
            opacity: 0;
            transform: scale(0.95);
        }
        
        .info-image.loaded {
            opacity: 1;
            transform: scale(1);
        }
        
        .image-fallback {
            background: linear-gradient(45deg, #f5f5f5 25%, #e0e0e0 50%, #f5f5f5 75%);
            background-size: 200% 200%;
            animation: gradientBG 2s ease infinite;
            width: 100%;
            height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #777;
            font-weight: bold;
            text-align: center;
            padding: 20px;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50% }
            50% { background-position: 100% 50% }
            100% { background-position: 0% 50% }
        }
        
        .loading-spinner {
            position: absolute;
            color: #3498db;
            font-size: 24px;
        }

        /* Cải tiến hiển thị video */
        .video-container {
            position: relative;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
            background: #f5f5f5;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border: 1px solid #eee;
            transition: all 0.3s ease;
            max-width: 100%;
        }
        
        .video-poster-container {
            position: relative;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }
        
        .video-poster {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }
        
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            color: white;
            text-shadow: 0 0 15px rgba(0,0,0,0.7);
            opacity: 0.9;
            transition: all 0.3s ease;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .video-poster-container:hover .play-button {
            transform: translate(-50%, -50%) scale(1.1);
            color: #ff0000;
            background: rgba(0,0,0,0.5);
        }
        
        .video-iframe {
            width: 100%;
            height: 400px;
            border: none;
            border-radius: 8px;
        }
        
        .video-link {
            display: inline-block;
            background: #e74c3c;
            color: white;
            padding: 12px 25px;
            border-radius: 6px;
            margin-top: 10px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .video-link:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .video-link i {
            margin-right: 8px;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 0.9rem;
            padding: 15px;
            border-top: 1px solid #eee;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.2);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .zoom-controls {
            position: absolute;
            top: 130px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 10;
        }
        
        .zoom-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 1px solid #ddd;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: #2c3e50;
            transition: all 0.2s ease;
        }
        
        .zoom-btn:hover {
            background: #f8f9fa;
            transform: scale(1.1);
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }
        
        .quiz-panel {
            background-color: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 20px;
        }
        
        .quiz-panel h5 {
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .quiz-panel h5 i {
            margin-right: 10px;
            color: #3498db;
        }
        
        .quiz-option {
            display: block;
            margin-bottom: 8px;
            padding: 10px 15px;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #dee2e6;
        }
        
        .quiz-option:hover {
            background-color: #e9f7fe;
            border-color: #3498db;
        }
        
        .quiz-option.selected {
            background-color: #d1ecf1;
            border-color: #117a8b;
        }
        
        .quiz-option input {
            margin-right: 10px;
        }
        
        .quiz-submit {
            margin-top: 15px;
            background-color: #28a745;
            border: none;
            padding: 10px 25px;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .quiz-submit:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
            font-weight: 500;
        }
        
        .quiz-correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .quiz-incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .node-highlight circle {
            stroke-width: 5px;
            stroke: #ff5722;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { r: 12; }
            50% { r: 16; }
            100% { r: 12; }
        }
        
        .search-container {
            margin-bottom: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .search-results {
            max-height: 250px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
            background: white;
            display: none;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .search-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            transition: all 0.2s;
        }
        
        .search-item:hover {
            background-color: #f0f8ff;
        }
        
        .search-item:last-child {
            border-bottom: none;
        }
        
        .search-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .search-header h2 {
            font-size: 1.8rem;
            color: #2c3e50;
        }
        
        /* Nút Kiểm tra mới */
        .test-button-container {
            text-align: center;
            margin: 30px 0;
        }
        
        .test-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(to right, #e74c3c, #e67e22);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .test-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, #c0392b, #d35400);
            color: white;
        }
        
        .test-button i {
            margin-right: 10px;
            font-size: 20px;
        }
        
        @media (max-width: 992px) {
            #tree-container {
                height: 550px;
            }
            
            .zoom-controls {
                top: 110px;
                right: 15px;
            }
            
            .info-image, .video-poster {
                max-height: 300px;
            }
            
            .video-iframe {
                height: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            #tree-container {
                height: 450px;
            }
            
            .node text {
                font-size: 12px;
            }
            
            .info-image, .video-poster {
                max-height: 250px;
            }
            
            .video-iframe {
                height: 250px;
            }
            
            .play-button {
                font-size: 36px;
                width: 60px;
                height: 60px;
            }
            
            .search-container {
                max-width: 100%;
            }
            
            .test-button {
                padding: 12px 25px;
                font-size: 16px;
            }
        }
        
        .info-section {
            margin-bottom: 25px;
        }
        
        .info-section-title {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .info-section-title i {
            margin-right: 8px;
            color: #3498db;
        }
        
        .close-video {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 20;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container text-center">
            <h1><i class="fas fa-atom"></i> Kim loại màu và Hợp kim màu</h1>
        </div>
    </div>

    <div class="container">
        <div class="search-header">
            <h2><i class="fas fa-diagram-project"></i> Sơ đồ tương tác</h2>
            <div class="search-container">
                <div class="input-group">
                    <input type="text" id="search-input" class="form-control" placeholder="Tìm kiếm theo tên...">
                    <button class="btn btn-primary" id="search-btn"><i class="fas fa-search"></i> Tìm kiếm</button>
                </div>
                <div class="search-results" id="search-results"></div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background-color: #2c3e50;"></div>
                <span>Gốc cây</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e74c3c;"></div>
                <span>Đồng</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #e67e22;"></div>
                <span>Hợp kim đồng</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #7f8c8d;"></div>
                <span>Nhôm</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #3498db;"></div>
                <span>Hợp kim nhôm</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #9b59b6;"></div>
                <span>Tính chất</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #2ecc71;"></div>
                <span>Ứng dụng</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #f1c40f;"></div>
                <span>Ký hiệu</span>
            </div>
        </div>
        
        <div id="tree-container">
            <div class="zoom-controls">
                <div class="zoom-btn" id="zoom-in"><i class="fas fa-search-plus"></i></div>
                <div class="zoom-btn" id="zoom-out"><i class="fas fa-search-minus"></i></div>
                <div class="zoom-btn" id="reset-view"><i class="fas fa-sync-alt"></i></div>
            </div>
        </div>
        
        <div id="info-panel">
            <h3 class="info-title"><i class="fas fa-info-circle"></i> Thông tin chi tiết</h3>
            <div class="text-center">
                <p class="lead">Nhấp vào một nút trên sơ đồ để xem thông tin, hình ảnh hoặc video</p>
                <i class="fas fa-arrow-down" style="font-size: 24px; color: #3498db;"></i>
            </div>
        </div>
        
        <!-- Nút Kiểm tra mới -->
        <div class="test-button-container">
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSek4SLHyEY9IM8HK_oUoXwDSeFx3Gp3HnG_0P3DNMnu4Qro9Q/viewform?usp=sharing&ouid=102407658230071622574" class="test-button" target="_blank" id="test-button">
                <i class="fas fa-clipboard-check"></i> Kiểm tra
            </a>
        </div>
    </div>
    
    <div class="footer container">
        <p>© 2025 Sơ đồ tương tác Kim loại màu và Hợp kim màu - Phục vụ giảng dạy và học tập</p>
    </div>

    <script>
        // Dữ liệu cây
        const treeData = {
            "name": ["Kim loại màu", "và Hợp kim màu"],
            "class": "root-node",
            "info": "Chào mừng bạn đến với sơ đồ tương tác về Kim loại màu và Hợp kim màu. Sơ đồ này cung cấp thông tin chi tiết về các loại kim loại màu phổ biến như đồng, nhôm và các hợp kim của chúng.<br><br>Hãy nhấp vào các nút trên sơ đồ để khám phá tính chất, ứng dụng và ký hiệu của từng loại vật liệu.",
            "quiz": {
                "question": "Kim loại màu thường được phân loại dựa trên đặc điểm gì?",
                "options": [
                    "Màu sắc bề mặt",
                    "Khả năng chống ăn mòn",
                    "Khối lượng riêng",
                    "Độ dẫn điện"
                ],
                "correctIndex": 0,
                "explanation": "Kim loại màu được phân loại chủ yếu dựa trên màu sắc đặc trưng của chúng như đồng (đỏ), nhôm (trắng bạc)..."
            },
            "children": [
                {
                    "name": "Đồng",
                    "class": "copper",
                    "info": "Đồng là kim loại có màu đỏ (nên còn được gọi là đồng đỏ). Đồng có khối lượng riêng lớn (γ = 8.94g/cm³), tính dẫn nhiệt, dẫn điện cao, tính chống ăn mòn tốt, khả năng chống mài mòn tốt, nhiệt độ nóng chảy tương đối cao (1083°C). Đồng có độ dẻo cao nhưng độ bền thấp (σb = 160N/mm², HB = 40) và có tính công nghệ kém.",
                    "quiz": {
                        "question": "Đồng có nhiệt độ nóng chảy là bao nhiêu?",
                        "options": [
                            "660°C",
                            "1083°C",
                            "1510°C",
                            "327°C"
                        ],
                        "correctIndex": 1,
                        "explanation": "Đồng có nhiệt độ nóng chảy khá cao là 1083°C, cao hơn nhôm (660°C) nhưng thấp hơn sắt (1538°C)."
                    },
                    "children": [
                        {
                            "name": "Tính chất",
                            "class": "properties",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-flask'></i> Tính chất của đồng:</div>
                                <ul>
                                    <li>Màu đỏ đặc trưng (đồng đỏ)</li>
                                    <li>Khối lượng riêng lớn (γ = 8.94g/cm³)</li>
                                    <li>Tính dẫn nhiệt, dẫn điện cao</li>
                                    <li>Tính chống ăn mòn tốt</li>
                                    <li>Khả năng chống mài mòn tốt</li>
                                    <li>Nhiệt độ nóng chảy: 1083°C</li>
                                    <li>Độ dẻo cao, độ bền thấp (σb = 160N/mm², HB = 40)</li>
                                    <li>Có tính công nghệ kém</li>
                                </ul>
                            </div>`,
                            "image": "https://raw.githubusercontent.com/caoquocdinh/anhkimloaimau/refs/heads/main/pure%20copper.jpg",
                            "video": "https://www.youtube.com/embed/EmrHt8l3I5I",
                            "quiz": {
                                "question": "Tính chất nào KHÔNG phải của đồng nguyên chất?",
                                "options": [
                                    "Độ dẻo cao",
                                    "Độ bền kéo lớn",
                                    "Dẫn điện tốt",
                                    "Chống ăn mòn"
                                ],
                                "correctIndex": 1,
                                "explanation": "Đồng nguyên chất có độ bền kéo thấp (khoảng 160N/mm²) nên thường được sử dụng dưới dạng hợp kim để tăng cơ tính."
                            }
                        },
                        {
                            "name": "Ứng dụng",
                            "class": "application",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-industry'></i> Ứng dụng của đồng:</div>
                                <ul>
                                    <li>Sản xuất dây điện, que hàn</li>
                                    <li>Bo mạch điện tử, ống chân không</li>
                                    <li>Tản nhiệt, chất bán dẫn</li>
                                    <li>Kết nối điện tử, điện cực</li>
                                    <li>Rơ le điện, nam châm điện</li>
                                    <li>Ống nước, hệ thống ống dẫn</li>
                                    <li>Trong kiến trúc và nghệ thuật</li>
                                </ul>
                            </div>
                            <p>Đồng nguyên chất có cơ tính thấp nên trong chế tạo máy thường chỉ dùng đồng ở dạng hợp kim.</p>`,
                            "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/copper%20application.jpg?raw=true",
                            "quiz": {
                                "question": "Ứng dụng chính của đồng nguyên chất là gì?",
                                "options": [
                                    "Chế tạo máy bay",
                                    "Sản xuất dây điện",
                                    "Làm khung xe hơi",
                                    "Sản xuất vũ khí"
                                ],
                                "correctIndex": 1,
                                "explanation": "Nhờ tính dẫn điện tốt, đồng nguyên chất được sử dụng rộng rãi trong sản xuất dây điện và các linh kiện điện tử."
                            }
                        },
                        {
                            "name": "Ký hiệu",
                            "class": "symbol",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-tag'></i> Ký hiệu đồng theo TCVN 5753:1993:</div>
                                <p>Theo Tiêu chuẩn Nhà nước TCVN 5753:1993 áp dụng cho đồng, được sản xuất dưới dạng catốt, thỏi đúc và các dạng bán thành phẩm. Trên mác đồng:</p>
                                <ul>
                                    <li>Chữ Cu chỉ nguyên tố đồng</li>
                                    <li>Chữ số chỉ hàm lượng đồng</li>
                                    <li>Chữ tiếp theo chỉ công nghệ nấu luyện đồng</li>
                                    <li>C: đồng catốt, tinh luyện bằng điện phân</li>
                                    <li>L: đồng thỏi hoặc bán thành phẩm, luyện bằng hỏa tinh luyện</li>
                                    <li>Kh: đồng thỏi hoặc bán thành phẩm nóng chảy lại với chất oxy hóa khử</li>
                                </ul>
                            </div>
                            <div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-list'></i> Ví dụ:</div>
                                <ul>
                                    <li>Cu 99,99 C: ≥99.99% Cu (đồng catốt)</li>
                                    <li>Cu 99,97 C: ≥99.97% Cu (đồng catốt)</li>
                                    <li>Cu 99,99 L: ≥99.99% Cu (thỏi hỏa tinh luyện)</li>
                                    <li>Cu 99,9 Kh: ≥99.90% Cu (thỏi khử oxy)</li>
                                    <li>Cu 99,85 Kh: ≥99.85% Cu (thỏi khử oxy)</li>
                                </ul>
                            </div>`,
                            "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/copper%20vietnam%20standard.jpg?raw=true",
                            "quiz": {
                                "question": "Ký hiệu Cu 99,99 C có nghĩa là gì?",
                                "options": [
                                    "Đồng có 99.99% tạp chất",
                                    "Đồng nguyên chất ≥99.99% dạng catốt",
                                    "Hợp kim đồng chứa 99.99% đồng",
                                    "Đồng có độ tinh khiết thấp"
                                ],
                                "correctIndex": 1,
                                "explanation": "Ký hiệu này chỉ đồng nguyên chất có độ tinh khiết ≥99.99% ở dạng catốt."
                            }
                        }
                    ]
                },
                {
                    "name": "Hợp kim đồng",
                    "class": "copper-alloy",
                    "info": "Theo thành phần hóa học, hợp kim đồng được chia thành 2 nhóm chính là: Đồng thau (Latông) và Đồng thanh (Brông). Hợp kim đồng và các tính chất của nó có vai trò quan trọng trong sản xuất gia công hiện đại. Chúng là nguyên liệu thích hợp để sản xuất dây chuyền thủy lực, bulong, ốc vít, khớp nối ren, van, bánh răng, vòng bi và nhiều chi tiết cơ khí khác.",
                    "quiz": {
                        "question": "Hợp kim đồng nào sau đây KHÔNG chứa kẽm?",
                        "options": [
                            "Latông",
                            "Brông thiếc",
                            "Đồng đỏ pha kẽm",
                            "Latông chì"
                        ],
                        "correctIndex": 1,
                        "explanation": "Brông thiếc là hợp kim đồng với thiếc, không chứa kẽm. Latông là hợp kim đồng-kẽm."
                    },
                    "children": [
                        {
                            "name": "Đồng thau (Latông)",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-coins'></i> Đồng thau (Latông):</div>
                                <p>Là hợp kim của đồng và kẽm với thành phần kẽm ≤ 45%.</p>
                                <p>Ứng dụng của đồng thau:</p>
                                <ul>
                                    <li>Dùng để hàn vảy cho các chi tiết đồng hoặc chi tiết gang</li>
                                    <li>Làm các ống tản nhiệt, ống dẫn và các chi tiết dập sâu</li>
                                    <li>Sử dụng trong sản xuất các thiết bị ngành điện tử</li>
                                    <li>Phụ kiện, ốc vít và đinh vít đồng thau</li>
                                </ul>
                                <p>Theo Tiêu chuẩn Nhà nước TCVN 1659-75, kí hiệu đồng thau bằng chữ L, sau đó là các chữ ký hiệu tên nguyên tố hóa học và chỉ số biểu thị hàm lượng trung bình của các nguyên tố theo phần trăm (%).</p>
                                <p>Ví dụ: LCuZn20 là đồng thau đơn giản, trong đó có 20% Zn, còn lại là đồng (80% Cu).</p>
                            </div>`,
                            "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/brass.jpg?raw=true",
                            "video": "https://www.youtube.com/embed/tFjZfa79bv0",                            
                            "children": [
                                {
                                    "name": "Đồng thau đơn giản",
                                    "info": `<div class='info-section'>
                                        <div class='info-section-title'><i class='fas fa-cog'></i> Đồng thau đơn giản:</div>
                                        <ul>
                                            <li>Là hợp kim đồng mà trong thành phần chỉ có 2 nguyên tố Cu và Zn</li>
                                            <li>Hàm lượng kẽm ≤ 45%</li>
                                            <li>Tính dẻo cao, dễ dập sâu</li>
                                            <li>Dùng làm ống tản nhiệt, ống dẫn và các chi tiết dập sâu</li>
                                            <li>Ví dụ: LCuZn10, LCuZn30</li>
                                        </ul>
                                    </div>`,
                                    "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/CuZn%20brass%20alloy.jpg?raw=true",
                                    "quiz": {
                                        "question": "Thành phần chính của đồng thau đơn giản là gì?",
                                        "options": [
                                            "Đồng và thiếc",
                                            "Đồng và kẽm",
                                            "Đồng và nhôm",
                                            "Đồng và chì"
                                        ],
                                        "correctIndex": 1,
                                        "explanation": "Đồng thau đơn giản là hợp kim của đồng và kẽm với hàm lượng kẽm ≤ 45%."
                                    }
                                },
                                {
                                    "name": "Đồng thau phức tạp",
                                    "info": `<div class='info-section'>
                                        <div class='info-section-title'><i class='fas fa-cogs'></i> Đồng thau phức tạp:</div>
                                        <p>Là hợp kim đồng trong đó ngoài Cu và Zn còn có thêm một số nguyên tố khác: Pb (Chì), Sn (Thiếc), Al, Ni, …</p>
                                        <p>Các nguyên tố thêm vào để cải thiện tính chất của HK đồng:</p>
                                        <ul>
                                            <li>Pb làm tăng tính cắt gọt</li>
                                            <li>Sn làm tăng tính chống ăn mòn</li>
                                            <li>Al, Ni làm tăng cơ tính</li>
                                        </ul>
                                        <p>Ví dụ: LCuZn29Sn1 là đồng thau phức tạp, 29%Zn và 1%Sn còn lại là Đồng (70%Cu).</p>
                                        <p>Các loại thường dùng: LCuZn29Sn1, LCuZn40Pb2</p>
                                        <p>Ứng dụng: hàn vảy, ốc vít, thiết bị điện tử, vỏ đạn</p>
                                    </div>`,
                                    "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/CuZnPb%20alloy.jpg?raw=true",
                                    "quiz": {
                                        "question": "Nguyên tố nào thường được thêm vào đồng thau để cải thiện khả năng gia công cắt gọt?",
                                        "options": [
                                            "Thiếc (Sn)",
                                            "Nhôm (Al)",
                                            "Chì (Pb)",
                                            "Niken (Ni)"
                                        ],
                                        "correctIndex": 2,
                                        "explanation": "Chì (Pb) được thêm vào để cải thiện khả năng gia công cắt gọt của đồng thau."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "Đồng thanh (Brông)",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-hammer'></i> Đồng thanh (Brông):</div>
                                <p>Là hợp kim của đồng với các nguyên tố hợp kim khác (trừ Zn) như Sn, Al, Pb, ... Do đó có tên gọi là brông thiếc, brông nhôm, ...</p>
                                <p>Brông thiếc có cơ tính cao, tính chống ăn mòn và khả năng chịu mài mòn tốt nên người ta thường sử dụng làm các bạc lót, ổ trượt, bánh vít, lò xo trong các thiết bị điện.</p>
                                <p>Theo Tiêu chuẩn Nhà nước TCVN 1659-75, kí hiệu đồng thanh bằng chữ B, sau đó là các chữ ký hiệu tên nguyên tố hóa học và chỉ số biểu thị hàm lượng trung bình của các nguyên tố theo phần trăm (%).</p>
                                <p>Một số mác đồng thanh là: BCuSn6; BCuSn6Zn6; BCuSn4Zn4Pb4.</p>
                                <p>Ví dụ: BCuSn6 là đồng thanh thiếc, trong đó có 6% Sn, còn lại là đồng; BCuSn40Pb1 là đồng thanh thiếc có 40% Sn, 1% Pb và 59% Cu.</p>
                            </div>`,
                            "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/bronze.jpg?raw=true",
                            "video": "https://www.youtube.com/embed/ysInnHOoouc",
                            "quiz": {
                                "question": "Brông thiếc thường được sử dụng để chế tạo gì?",
                                "options": [
                                    "Dây điện",
                                    "Bạc lót, ổ trượt",
                                    "Khung cửa sổ",
                                    "Vỏ điện thoại"
                                ],
                                "correctIndex": 1,
                                "explanation": "Nhờ tính chống mài mòn tốt, brông thiếc thường dùng làm bạc lót, ổ trượt trong các bộ phận máy móc."
                            }
                        }
                    ]
                },
                {
                    "name": "Nhôm",
                    "class": "aluminum",
                    "info": "Nhôm là kim loại nhẹ: so với thép và đồng, khối lượng riêng của nhôm chỉ bằng 1/3, nên được dùng rộng rãi trong ngành hàng không, giao thông vận tải, trang thiết bị quân sự, xây dựng… Nhôm có độ dẫn điện, dẫn nhiệt khá cao, tính chống ăn mòn cao, nhiệt độ nóng chảy thấp (660°C), dễ đúc nhưng co ngót nhiều (6%), độ dẻo cao nhưng độ bền thấp.",
                    "quiz": {
                        "question": "Nhôm có khối lượng riêng là bao nhiêu?",
                        "options": [
                            "2.70 g/cm³",
                            "7.87 g/cm³",
                            "8.94 g/cm³",
                            "11.34 g/cm³"
                        ],
                        "correctIndex": 0,
                        "explanation": "Khối lượng riêng của nhôm là 2.70 g/cm³, chỉ bằng khoảng 1/3 khối lượng riêng của thép."
                    },
                    "children": [
                        {
                            "name": "Tính chất",
                            "class": "properties",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-flask'></i> Tính chất của nhôm:</div>
                                <ul>
                                    <li>Nhôm là kim loại nhẹ: khối lượng riêng nhỏ (2.7 g/cm³, ≈1/3 thép)</li>
                                    <li>Độ dẫn điện, dẫn nhiệt khá cao</li>
                                    <li>Tính chống ăn mòn cao: nhôm tạo oxít nhôm Al₂O₃ bám chặt vào bề mặt tạo lớp bảo vệ</li>
                                    <li>Nhiệt độ nóng chảy thấp (660°C)</li>
                                    <li>Dễ đúc nhưng co ngót nhiều (khoảng 6%)</li>
                                    <li>Độ dẻo cao, độ bền thấp</li>
                                    <li>Cơ tính có thể cải thiện bằng gia công nhiệt</li>
                                </ul>
                            </div>`,
                            "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/aluminium.jpg?raw=true",
                            "video": "https://www.youtube.com/embed/uIkWFPFrPfA",
                            "quiz": {
                                "question": "Tại sao nhôm có khả năng chống ăn mòn tốt?",
                                "options": [
                                    "Do có lớp mạ bảo vệ",
                                    "Do lớp oxit Al₂O₃ tự hình thành",
                                    "Do không phản ứng với oxy",
                                    "Do cấu trúc tinh thể đặc biệt"
                                ],
                                "correctIndex": 1,
                                "explanation": "Nhôm tạo ra một lớp oxit Al₂O₃ mỏng, bền vững trên bề mặt giúp bảo vệ nó khỏi sự ăn mòn."
                            }
                        },
                        {
                            "name": "Ứng dụng",
                            "class": "application",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-industry'></i> Ứng dụng của nhôm:</div>
                                <ul>
                                    <li>Công nghiệp hàng không vũ trụ</li>
                                    <li>Giao thông vận tải (ô tô, tàu hỏa)</li>
                                    <li>Xây dựng (khung vòm, cửa sổ)</li>
                                    <li>Dây dẫn điện (giảm trọng lượng 1,63 lần so với đồng)</li>
                                    <li>Thùng chứa, bao bì thực phẩm</li>
                                    <li>Giấy nhôm, thanh nẹp trang trí</li>
                                    <li>Thiết bị điện tử, tản nhiệt</li>
                                    <li>Chế tạo các thiết bị, bình chứa và chuyên chở axit nitric</li>
                                    <li>Công nghiệp thực phẩm: thùng, bình, lon đựng sữa, bia</li>
                                </ul>
                            </div>
                            <p>Nhôm nguyên chất do có độ bền thấp nên phạm vi sử dụng hạn chế, thường dùng trong công nghiệp điện và công nghiệp tiêu dùng. Để sử dụng rộng rãi hơn, nhôm được sử dụng dưới dạng hợp kim.</p>`,
                            "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/aluminum%20application.jpg?raw=true",
                            "quiz": {
                                "question": "Tại sao nhôm được ưa chuộng trong công nghiệp hàng không?",
                                "options": [
                                    "Giá thành rẻ",
                                    "Khả năng chịu nhiệt cao",
                                    "Trọng lượng nhẹ",
                                    "Màu sắc đẹp"
                                ],
                                "correctIndex": 2,
                                "explanation": "Nhôm có trọng lượng nhẹ (khối lượng riêng chỉ 2.7 g/cm³) giúp giảm trọng lượng máy bay, tiết kiệm nhiên liệu."
                            }
                        },
                        {
                            "name": "Ký hiệu",
                            "class": "symbol",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-tag'></i> Ký hiệu nhôm theo TCVN 5910-1995:</div>
                                <p>Theo Tiêu chuẩn Nhà nước TCVN 5910 - 1995, kí hiệu nhôm là chữ Al và chỉ số sau kí hiệu là chỉ % hàm lượng nhôm nguyên chất tính theo phần trăm; chữ "E" phía trước (nếu có) chỉ sử dụng cho vật liệu với các đặc tính về điện được đảm bảo.</p>
                            </div>
                            <div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-list'></i> Ví dụ:</div>
                                <ul>
                                    <li>Al99,7: Nhôm chứa 99,70% nhôm</li>
                                    <li>E-Al99,7: Nhôm chứa 99,70% nhôm, đặc tính về điện được đảm bảo</li>
                                    <li>Al99,5: Nhôm chứa 99,50% nhôm</li>
                                </ul>
                            </div>`,
                            "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/aluminium%20symbol.jpg?raw=true",
                            "quiz": {
                                "question": "Ký hiệu E-Al99,7 có nghĩa là gì?",
                                "options": [
                                    "Nhôm có độ tinh khiết 99.7%",
                                    "Nhôm có đặc tính điện đảm bảo",
                                    "Hợp kim nhôm chứa 99.7% Al",
                                    "Nhôm dùng trong xây dựng"
                                ],
                                "correctIndex": 1,
                                "explanation": "Chữ 'E' trong ký hiệu chỉ loại nhôm có đặc tính điện đảm bảo, thường dùng trong ngành điện."
                            }
                        }
                    ]
                },
                {
                    "name": "Hợp kim nhôm",
                    "class": "aluminum-alloy",
                    "info": "Theo công dụng người ta chia hợp kim nhôm thành 2 nhóm chính: hợp kim nhôm gia công áp lực và hợp kim nhôm đúc. Hợp kim nhôm thường dùng chế tạo chi tiết máy như piston, tay biên và vỏ hộp tốc độ xe máy. Nhờ trọng lượng nhẹ và độ bền, thẩm mỹ, chúng được ứng được sử dụng phổ biến trong chế tạo máy bay (vỏ máy bay, một số bộ phận trên máy bay) và cũng như các thiết bị, máy móc cho ngành hàng không vũ trụ.",
                    "quiz": {
                        "question": "Hợp kim nhôm nào sau đây có thể hóa bền bằng nhiệt luyện?",
                        "options": [
                            "Hợp kim Al-Mg",
                            "Hợp kim Al-Si",
                            "Hợp kim Al-Cu-Mg",
                            "Hợp kim Al-Mn"
                        ],
                        "correctIndex": 2,
                        "explanation": "Hợp kim Al-Cu-Mg (đuara) có thể được hóa bền bằng phương pháp nhiệt luyện (tôi và hóa già)."
                    },
                    "children": [
                        {
                            "name": "Hợp kim nhôm gia công áp lực",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-tools'></i> Hợp kim nhôm gia công áp lực:</div>
                                <p>Là hợp kim của nhôm với các nguyên tố hợp kim có hàm lượng thấp, thường được chế tạo thành tấm, thỏi, dây, ống. Hợp kim nhôm biến dạng được dùng để chế tạo các chi tiết bằng phương pháp gia công áp lực nóng hoặc nguội.</p>
                                <p>Theo Tiêu chuẩn Nhà nước TCVN 5910 - 1995, kí hiệu hợp kim nhôm gia công áp lực theo thứ tự ưu tiên giảm dần. Nguyên tố hợp kim chính được phân biệt bằng cách ghi rõ thành phần selon yêu cầu (trung bình được làm tròn tới 0,5).</p>
                                <p>Ví dụ: AlMg2, AlMg2,5, AlSi1Mg0,8, AlZn6CuMgZr.</p>
                                <p>Các áp dụng đặc biệt của hợp kim: Có thể sẽ đặt tên các hợp kim phù hợp với thực tế. Sử dụng tiền tố "E – "sử dụng cho các hợp kim nhôm với các đặc tính về điện được đảm bảo. Ví dụ: E-AlMgSi.</p>
                            </div>`,
                            "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/wrought%20aluminum.png?raw=true",
                            "video": "https://www.youtube.com/embed/IISS9jwc7Jw",
                            "children": [
                                {
                                    "name": "Không hóa bền nhiệt luyện",
                                    "info": `<div class='info-section'>
                                        <div class='info-section-title'><i class='fas fa-fire-extinguisher'></i> Không hóa bền nhiệt luyện:</div>
                                        <ul>
                                            <li>Hợp kim Al-Mn, Al-Mg</li>
                                            <li>Al-Mn: cơ tính cao, hàn tốt, chống ăn mòn</li>
                                            <li>Al-Mg: khối lượng riêng nhỏ, đàn hồi tốt, giới hạn bền mỏi tương đối lớn, có khả năng chống ăn mòn trong môi trường khí quyển và giảm chấn tốt</li>
                                            <li>Dùng trong xây dựng (cửa, vách ngăn)</li>
                                            <li>Ví dụ: AlMg2, E-AlMgSi</li>
                                        </ul>
                                    </div>`,
                                    "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/non%20heatreatable%20wrought%20aluminum%20alloy.jpg?raw=true",
                                    "quiz": {
                                        "question": "Hợp kim Al-Mg thường được sử dụng trong lĩnh vực nào?",
                                        "options": [
                                            "Chế tạo động cơ máy bay",
                                            "Sản xuất dây cáp điện",
                                            "Khung cửa sổ, vách ngăn",
                                            "Chế tạo piston động cơ"
                                        ],
                                        "correctIndex": 2,
                                        "explanation": "Hợp kim Al-Mg có khả năng chống ăn mòn tốt và dễ hàn, thường dùng trong xây dựng như khung cửa sổ, vách ngăn."
                                    }
                                },
                                {
                                    "name": "Hóa bền nhiệt luyện",
                                    "info": `<div class='info-section'>
                                        <div class='info-section-title'><i class='fas fa-fire'></i> Hóa bền nhiệt luyện:</div>
                                        <ul>
                                            <li>Hợp kim Al-Cu, Al-Cu-Mg (đuara)</li>
                                            <li>Độ bền cao sau tôi, hóa già</li>
                                            <li>Nếu tỷ lệ Mg/Cu hợp lý thì đuara giữ được độ bền ở nhiệt độ 200 – 250°C</li>
                                            <li>Tuy nhiên, đuara có tính hàn và khả năng chống ăn mòn kém</li>
                                            <li>Dùng trong máy bay, ô tô, tuabin</li>
                                            <li>Ví dụ: AlCu4,5Mg0,5MnSi, AlCu4,5Mg1,5Mn0,5Al</li>
                                            <li>Đuara có cơ tính trung bình và tính hàn tốt, dễ gia công áp lực nóng, thường dùng để chế tạo các kết cấu hàn, các chi tiết làm việc dưới 150°C</li>
                                        </ul>
                                    </div>`,
                                    "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/duralumin.jpg?raw=true",
                                    "quiz": {
                                        "question": "Hợp kim đuara (Al-Cu-Mg) thường được sử dụng trong ngành nào?",
                                        "options": [
                                            "Sản xuất đồ gia dụng",
                                            "Chế tạo máy bay",
                                            "Làm bao bì thực phẩm",
                                            "Sản xuất dây điện"
                                        ],
                                        "correctIndex": 1,
                                        "explanation": "Nhờ độ bền cao và tỷ lệ độ bền/trọng lượng tốt, đuara được sử dụng rộng rãi trong công nghiệp hàng không để chế tạo máy bay."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "Hợp kim nhôm đúc",
                            "info": `<div class='info-section'>
                                <div class='info-section-title'><i class='fas fa-cube'></i> Hợp kim nhôm đúc:</div>
                                <p>Là hợp kim nhôm có nhiều nguyên tố hợp kim có nhiệt độ nóng chảy thấp hơn do đó có tính đúc cao. Loại này giòn hơn nên không gia công áp lực được, khả năng hóa bền bằng nhiệt luyện kém.</p>
                                <p>Đây là nhóm hợp kim nhôm có tính đúc tốt, dùng chế tạo các sản phẩm bằng phương pháp đúc. Để đạt được tính đúc tốt, hợp kim nhôm đúc cần có nhiệt độ nóng chảy thấp, do vậy thành phần hóa học càng gần cùng tinh càng tốt. Các hợp kim nhôm đúc thông dụng thường là các hệ hợp kim Al-Si; Al-Cu; Al-Mg.</p>
                                <p>Ví dụ: AlSi7Cu2, AlMg5</p>
                                <p>Dùng làm piston, tay biên, vỏ hộp tốc độ</p>
                                <p>Ký hiệu theo TCVN 1659-75, kí hiệu hợp kim nhôm đúc bằng chữ Al, sau đó là các chữ ký hiệu tên nguyên tố hóa học và chỉ số biểu thị hàm lượng trung bình của các nguyên tố theo phần trăm (%).
Ví dụ: AlSi7Cu2 là hợp kim nhôm đúc có 7% Si, 2% Cu, còn lại là Al; AlMg5 là hợp kim nhôm đúc có 5% Mg, còn lại là Al.</p>
                            </div>`,
                            "image": "https://github.com/caoquocdinh/anhkimloaimau/blob/main/cast%20aluminum%20alloy%20application.png?raw=true",
                            "video": "https://www.youtube.com/embed/Gg-pZZpuXCE",
                            "quiz": {
                                "question": "Tại sao hợp kim nhôm đúc thường chứa silic?",
                                "options": [
                                    "Để tăng độ dẫn điện",
                                    "Để cải thiện tính đúc",
                                    "Để giảm giá thành",
                                    "Để tăng độ bền kéo"
                                ],
                                "correctIndex": 1,
                                "explanation": "Silicon giúp cải thiện tính đúc của hợp kim nhôm, giảm co ngót và tăng tính lưu động khi rót khuôn."
                            }
                        }
                    ]
                }
            ]
        };

        // Kích thước và cấu hình ban đầu
        const width = 1200;
        const height = 720;
        let zoomLevel = 1;
        let transformX = 200; // Đã điều chỉnh để phù hợp với cây mới
        let transformY = 50;  // Đã điều chỉnh để phù hợp với cây mới
        let nodesData = [];
        let currentTransform = d3.zoomIdentity;
        let videoCounter = 0;

        // Tạo SVG container
        const svg = d3.select("#tree-container")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .call(d3.zoom().on("zoom", (event) => {
                currentTransform = event.transform;
                svgGroup.attr("transform", event.transform);
            }))
            .on("dblclick.zoom", null);

        const svgGroup = svg.append("g")
            .attr("transform", `translate(${transformX}, ${transformY})`);

        // Tạo root hierarchy
        const root = d3.hierarchy(treeData);
        let nodeId = 0;
        root.descendants().forEach(node => {
            node.id = nodeId++;
            nodesData.push({
                id: node.id,
                name: Array.isArray(node.data.name) ? node.data.name.join(' ') : node.data.name,
                data: node.data
            });
        });

        // Cấu hình layout cây - đã điều chỉnh để rút ngắn các nhánh
        const treeLayout = d3.tree().size([(height - 120) * 0.8, (width - 200) * 0.8]);
        treeLayout(root);

        // Vẽ các đường kết nối
        svgGroup.selectAll(".link")
            .data(root.links())
            .enter()
            .append("path")
            .attr("class", "link")
            .attr("d", d3.linkHorizontal()
                .x(d => d.y)
                .y(d => d.x));

        // Vẽ các nút
        const nodes = svgGroup.selectAll(".node")
            .data(root.descendants())
            .enter()
            .append("g")
            .attr("class", "node")
            .attr("id", d => `node-${d.id}`)
            .attr("transform", d => `translate(${d.y},${d.x})`);

        // Vẽ hình tròn cho nút - tăng kích thước nút gốc
        nodes.append("circle")
            .attr("r", d => d.depth === 0 ? 20 : 12) // Nút gốc to hơn (20 so với 12)
            .attr("class", d => d.data.class || "")
            .on("click", (event, d) => {
                updateInfoPanel(d.data);
                highlightNode(d);
                centerNode(d);
            });

        // Vẽ văn bản cho nút (dòng đầu tiên) - tăng kích thước chữ cho nút gốc
        nodes.append("text")
            .attr("dy", d => d.depth === 0 ? "-0.7em" : ".35em")
            .attr("x", d => d.children ? -22 : 22) // Điều chỉnh vị trí chữ cho phù hợp với nút lớn hơn
            .style("text-anchor", d => d.children ? "end" : "start")
            .style("font-size", d => d.depth === 0 ? "18px" : "14px") // Chữ nút gốc lớn hơn
            .text(d => {
                if (d.depth === 0) {
                    return d.data.name[0]; // Dòng đầu tiên cho nút gốc
                }
                return d.data.name;
            });

        // Vẽ dòng thứ hai cho nút gốc - tăng kích thước chữ
        nodes.filter(d => d.depth === 0).append("text")
            .attr("dy", "1.2em")
            .attr("x", d => d.children ? -22 : 22) // Điều chỉnh vị trí chữ
            .style("text-anchor", d => d.children ? "end" : "start")
            .style("font-size", "18px") // Chữ nút gốc lớn hơn
            .text(d => d.data.name[1]); // Dòng thứ hai cho nút gốc

        // Hàm lấy ảnh fallback
        function getFallbackImage(className, name) {
            const colors = {
                'copper': 'e74c3c',
                'copper-alloy': 'e67e22',
                'aluminum': '7f8c8d',
                'aluminum-alloy': '3498db',
                'properties': '9b59b6',
                'application': '2ecc71',
                'symbol': 'f1c40f',
                'root-node': '2c3e50'
            };
            const color = colors[className] || '3498db';
            return `https://via.placeholder.com/800x400/${color}/ffffff?text=${encodeURIComponent(name)}`;
        }

        // Hàm chuyển đổi URL YouTube sang dạng embed
        function convertToEmbedUrl(url) {
            if (!url) return '';
            
            // Xử lý URL YouTube thông thường
            if (url.includes('youtube.com/watch')) {
                const videoId = url.split('v=')[1];
                const ampersandPosition = videoId.indexOf('&');
                if (ampersandPosition !== -1) {
                    return 'https://www.youtube.com/embed/' + videoId.substring(0, ampersandPosition);
                }
                return 'https://www.youtube.com/embed/' + videoId;
            }
            
            // Xử lý URL YouTube Shorts
            if (url.includes('youtube.com/shorts/')) {
                const videoId = url.split('shorts/')[1];
                if (videoId.includes('?')) {
                    return 'https://www.youtube.com/embed/' + videoId.split('?')[0];
                }
                return 'https://www.youtube.com/embed/' + videoId;
            }
            
            // Nếu đã là embed URL thì trả về nguyên bản
            if (url.includes('youtube.com/embed')) {
                return url;
            }
            
            return url;
        }

        // Cập nhật bảng thông tin
        async function updateInfoPanel(data) {
            const infoPanel = d3.select("#info-panel");
            
            // Ghép lại tên đầy đủ nếu là mảng
            const fullName = Array.isArray(data.name) 
                ? data.name.join(' ') 
                : data.name;
            
            let content = `<h3 class="info-title"><i class="fas fa-info-circle"></i> ${fullName}</h3>`;
            
            if (data.info) {
                content += `<div class="info-content">${data.info}</div>`;
            } else {
                content += `<p class="info-content">${data.children ? "Chọn một nút con để xem chi tiết" : "Chưa có thông tin chi tiết"}</p>`;
            }
            
            // Hiển thị hình ảnh
            if (data.image) {
                content += `<div class="image-container" id="current-image-container"></div>`;
            }
            
            // Hiển thị video với poster
            if (data.video) {
                videoCounter++;
                const uniqueId = `video-${videoCounter}`;
                const posterUrl = data.image || getFallbackImage(data.class, fullName);
                const embedUrl = convertToEmbedUrl(data.video);
                
                content += `
                    <div class="video-container" id="${uniqueId}">
                        <div class="video-poster-container">
                            <img src="${posterUrl}" class="video-poster" alt="Video poster" 
                                 onerror="this.src='${getFallbackImage(data.class, fullName)}'">
                            <div class="play-button"><i class="fas fa-play-circle"></i></div>
                        </div>
                    </div>`;
            }
            
            if (data.children && data.children.length > 0 && !data.info) {
                content += `<div class="mt-4"><strong>Các thành phần chính:</strong><ul>`;
                data.children.forEach(child => {
                    content += `<li>${child.name}</li>`;
                });
                content += `</ul></div>`;
            }
            
            // Thêm câu hỏi nếu có
            if (data.quiz) {
                content += generateQuizHTML(data.quiz);
            }
            
            infoPanel.html(content);
            
            // Xử lý ảnh sau khi render
            if (data.image) {
                const container = document.getElementById('current-image-container');
                const img = new Image();
                const fallbackUrl = getFallbackImage(data.class, fullName);
                
                // Thêm spinner loading
                const spinner = document.createElement('div');
                spinner.className = 'loading-spinner';
                spinner.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                container.appendChild(spinner);
                
                img.onload = function() {
                    spinner.remove();
                    this.className = 'info-image loaded';
                    container.innerHTML = '';
                    container.appendChild(this);
                };
                
                img.onerror = function() {
                    spinner.remove();
                    this.src = fallbackUrl;
                    this.onerror = null;
                    this.className = 'info-image loaded';
                    container.innerHTML = '';
                    container.appendChild(this);
                };
                
                img.src = data.image;
                img.alt = fullName;
            }
            
            // Xử lý video sau khi render
            if (data.video) {
                const containerId = `video-${videoCounter}`;
                const container = document.getElementById(containerId);
                const posterContainer = container.querySelector('.video-poster-container');
                const embedUrl = convertToEmbedUrl(data.video);
                
                posterContainer.addEventListener('click', function() {
                    // Tạo iframe để nhúng video
                    const iframe = document.createElement('iframe');
                    iframe.className = 'video-iframe';
                    iframe.src = embedUrl + '?autoplay=1';
                    iframe.allowFullscreen = true;
                    iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                    
                    // Tạo nút đóng
                    const closeButton = document.createElement('button');
                    closeButton.className = 'close-video';
                    closeButton.innerHTML = '<i class="fas fa-times"></i>';
                    closeButton.addEventListener('click', function(e) {
                        e.stopPropagation();
                        container.innerHTML = '';
                        container.appendChild(posterContainer);
                    });
                    
                    // Thay thế poster bằng iframe
                    container.innerHTML = '';
                    container.appendChild(iframe);
                    container.appendChild(closeButton);
                });
            }
            
            // Thêm sự kiện cho câu hỏi
            if (data.quiz) {
                document.querySelectorAll('.quiz-option').forEach(option => {
                    option.addEventListener('click', function() {
                        document.querySelectorAll('.quiz-option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        this.classList.add('selected');
                    });
                });
                
                const submitBtn = document.querySelector('.quiz-submit');
                if (submitBtn) {
                    submitBtn.addEventListener('click', function() {
                        const selectedOption = document.querySelector('.quiz-option.selected');
                        if (!selectedOption) {
                            alert("Vui lòng chọn một đáp án!");
                            return;
                        }
                        
                        const selectedIndex = parseInt(selectedOption.dataset.index);
                        const correctIndex = data.quiz.correctIndex;
                        const feedback = document.querySelector('.quiz-feedback');
                        
                        if (selectedIndex === correctIndex) {
                            feedback.innerHTML = `<i class="fas fa-check-circle"></i> <strong>Chính xác!</strong> ${data.quiz.explanation}`;
                            feedback.className = "quiz-feedback quiz-correct";
                        } else {
                            feedback.innerHTML = `<i class="fas fa-times-circle"></i> <strong>Sai rồi!</strong> ${data.quiz.explanation}`;
                            feedback.className = "quiz-feedback quiz-incorrect";
                        }
                        
                        feedback.style.display = "block";
                    });
                }
            }
        }

        // Tạo hiệu ứng highlight cho nút được chọn
        function highlightNode(node) {
            // Xóa highlight cũ
            d3.selectAll(".node-highlight").classed("node-highlight", false);
            
            // Thêm highlight mới
            d3.select(`#node-${node.id}`).select("circle")
                .classed("node-highlight", true);
        }

        // Tạo HTML cho câu hỏi
        function generateQuizHTML(quizData) {
            let html = `
                <div class="quiz-panel mt-4">
                    <h5><i class="fas fa-question-circle"></i> Câu hỏi kiểm tra nhanh:</h5>
                    <p>${quizData.question}</p>
                    <div>`;
            
            quizData.options.forEach((option, index) => {
                html += `
                    <div class="quiz-option" data-index="${index}">
                        <input type="radio" name="quiz" id="option${index}">
                        <label for="option${index}">${option}</label>
                    </div>`;
            });
            
            html += `
                    </div>
                    <button class="quiz-submit"><i class="fas fa-paper-plane"></i> Kiểm tra đáp án</button>
                    <div class="quiz-feedback"></div>
                </div>`;
            
            return html;
        }

        // Khởi tạo bảng thông tin
        updateInfoPanel({
            name: ["Kim loại màu", "và Hợp kim màu"],
            info: "Chào mừng bạn đến với sơ đồ tương tác về Kim loại màu và Hợp kim màu. Sơ đồ này cung cấp thông tin chi tiết về các loại kim loại màu phổ biến như đồng, nhôm và các hợp kim của chúng.<br><br>Hãy nhấp vào các nút trên sơ đồ để khám phá tính chất, ứng dụng và ký hiệu của từng loại vật liệu.",
            quiz: treeData.quiz
        });

        // Chức năng zoom
        d3.select("#zoom-in").on("click", function() {
            zoomLevel = Math.min(2, zoomLevel * 1.2);
            applyZoom();
        });

        d3.select("#zoom-out").on("click", function() {
            zoomLevel = Math.max(0.5, zoomLevel * 0.8);
            applyZoom();
        });

        d3.select("#reset-view").on("click", function() {
            zoomLevel = 1;
            transformX = 200; // Cập nhật giá trị mới
            transformY = 50;  // Cập nhật giá trị mới
            applyZoom();
        });

        function applyZoom() {
            svgGroup.transition()
                .duration(300)
                .attr("transform", `translate(${transformX}, ${transformY}) scale(${zoomLevel})`);
        }

        // Tập trung vào nút khi được chọn
        function centerNode(node) {
            const containerWidth = document.getElementById("tree-container").clientWidth;
            const containerHeight = document.getElementById("tree-container").clientHeight;
            
            const targetX = containerWidth / 2 - node.y * zoomLevel;
            const targetY = containerHeight / 2 - node.x * zoomLevel;
            
            transformX = targetX;
            transformY = targetY;
            
            applyZoom();
        }

        // Chức năng tìm kiếm
        document.getElementById("search-input").addEventListener("input", function() {
            const searchTerm = this.value.toLowerCase().trim();
            const resultsContainer = document.getElementById("search-results");
            
            if (!searchTerm) {
                resultsContainer.style.display = "none";
                return;
            }
            
            const matches = nodesData.filter(node => 
                node.name.toLowerCase().includes(searchTerm)
            );
            
            if (matches.length > 0) {
                resultsContainer.innerHTML = matches.map(node => 
                    `<div class="search-item" data-id="${node.id}">${node.name}</div>`
                ).join("");
                resultsContainer.style.display = "block";
                
                // Thêm sự kiện cho kết quả tìm kiếm
                document.querySelectorAll(".search-item").forEach(item => {
                    item.addEventListener("click", function() {
                        const nodeId = parseInt(this.dataset.id);
                        const foundNode = root.descendants().find(node => node.id === nodeId);
                        
                        if (foundNode) {
                            updateInfoPanel(foundNode.data);
                            highlightNode(foundNode);
                            centerNode(foundNode);
                            
                            // Đóng kết quả tìm kiếm
                            resultsContainer.style.display = "none";
                        }
                    });
                });
            } else {
                resultsContainer.innerHTML = "<div class='search-item'>Không tìm thấy kết quả</div>";
                resultsContainer.style.display = "block";
            }
        });

        // Đóng kết quả tìm kiếm khi click ra ngoài
        document.addEventListener("click", function(e) {
            const resultsContainer = document.getElementById("search-results");
            if (resultsContainer.style.display === "block" && 
                !e.target.closest(".search-container")) {
                resultsContainer.style.display = "none";
            }
        });

        // ĐÃ XÓA: Chức năng "bạn có phải là giáo viên không" trong nút Kiểm tra
        // Nút Kiểm tra giờ đây sẽ trực tiếp mở Google Form
        document.getElementById('test-button').addEventListener('click', function(e) {
            // Không cần xử lý gì thêm, chỉ cần mở link Google Form đã được thiết lập trong href
            console.log("Mở Google Form để kiểm tra");
        });
    </script>
</body>
</html>